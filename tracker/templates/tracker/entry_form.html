<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meg's Monthly Bank Tracker</title>
    <!-- Add Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% load static %}

    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/account-management.css' %}">
</head>

<body class="bg-gray-50">

    <header class="fixed top-0 left-0 right-0 py-4 px-4 z-50">
        <div
            class="mx-auto flex justify-center items-center bg-gradient-to-r from-[#fef7e2] to-[#f3e7f6] shadow-md px-8 py-3 rounded-full text-gray-800 max-w-4xl">
            <!-- Left: Logo and Name -->
            <div class="flex items-center space-x-3">
                <span class="items-center font-semibold text-lg">Monthly Money Tracker</span>
            </div>

            <!-- Middle: Navigation Links (Hidden on small screens, shown on md and up) -->
            <nav class="hidden md:flex gap-8 font-medium">
                <!-- <a href="#about" class="hover:text-black transition">About</a>-->
            </nav>
        </div>
    </header>


    {% load account_filters %}
    <div class="container mx-auto px-4 py-20">
        <!-- Enhanced Charts Section with Improved Layout -->
        <div class="bg-white rounded-lg shadow-md p-5 mb-8 py-15">
            <div class="flex flex-col md:flex-row md:flex-wrap">
                <!-- Pie Chart Section -->
                <div class="md:w-2/5 pr-0 md:pr-4 mb-6 md:mb-0">
                    <h2 class="text-lg font-semibold mb-2">Account Type Distribution</h2>
                    <div style="height: 280px; position: relative;">
                        <canvas id="assetsLiabilitiesPieChart"></canvas>
                    </div>
                </div>

                <!-- Line Chart Section -->
                <div class="md:w-3/5">
                    <h2 class="text-lg font-semibold mb-2">Financial Summary</h2>
                    <div style="height: 280px; position: relative;">
                        <canvas id="financialSummaryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Year Selector and Month Scroller -->
        <div class="bg-white rounded-lg shadow-md p-5 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Monthly View</h2>
                <div class="flex items-center space-x-4">
                    <button id="scrollLeft" class="bg-gray-200 hover:bg-gray-300 rounded-full p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="scrollRight" class="bg-gray-200 hover:bg-gray-300 rounded-full p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Horizontal Month Scroller -->
            <div class="overflow-x-auto pb-4" id="monthScroller">
                <div class="flex space-x-4">
                    <!-- Month cards will be populated based on selected year -->
                    {% for month_name, month_data in current_year_months %}
                    <div class="month-card flex-shrink-0 w-64 bg-gray-50 rounded-lg shadow-sm p-4 {% if month_data.is_current %}current{% endif %}"
                        data-month="{{ month_name }}">
                        <h3 class="font-semibold text-lg mb-3">{{ month_name }}</h3>

                        <div class="space-y-2">
                            <!-- Current Accounts Summary -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Current:</span>
                                <span class="text-right">£{{ month_data.current|sum_amounts }}</span>
                            </div>

                            <!-- Savings Accounts Summary -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Savings:</span>
                                <span class="text-right">£{{ month_data.savings|sum_amounts }}</span>
                            </div>

                            <!-- Lending Accounts Summary -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Lending:</span>
                                <span class="text-right">£{{ month_data.lending|sum_amounts }}</span>
                            </div>

                            <!-- Deposits -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Deposits:</span>
                                <span class="text-right">£{{ month_data.deposits|sum_amounts }}</span>
                            </div>

                            <!-- Pensions -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Pensions:</span>
                                <span class="text-right">£{{ month_data.pensions|sum_amounts }}</span>
                            </div>

                            <!-- Credit Cards -->
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Credit Cards:</span>
                                <span class="text-right">£{{ month_data.credit_cards|sum_amounts }}</span>
                            </div>
                        </div>

                        <!-- Total Assets for Month -->
                        <div class="pt-2 mt-2 border-t">
                            <div class="flex justify-between items-center font-semibold">
                                <span>Total:</span>
                                <span class="text-right">£{{ month_data|calculate_total_assets }}</span>
                            </div>
                        </div>

                        <!-- Edit Button -->
                        <div class="mt-3 text-center">
                            <button
                                class="edit-month-btn bg-red-300 hover:bg-red-700 text-grey text-sm font-medium py-1 px-3 rounded"
                                data-month-full="{{ month_name }}">
                                Edit Accounts
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>


            <!-- Selected Month Detail View (initially hidden) -->
            <div id="monthDetailView" class="bg-white rounded-lg shadow-md overflow-hidden mb-8 hidden">
                <!-- Header -->
                <div class="bg-gray-50 border-b p-4 flex justify-between items-center">
                    <h2 class="text-lg font-semibold" id="detailViewTitle">Month Detail</h2>
                    <button id="closeDetailView" class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Account Type Tabs -->
                <div class="border-b border-gray-200">
                    <nav class="flex overflow-x-auto" aria-label="Account Types">
                        <button class="account-tab-btn active px-4 py-2 text-sm font-medium border-b-2 border-blue-500"
                            data-type="current">
                            Current Accounts
                        </button>
                        <button
                            class="account-tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                            data-type="savings">
                            Savings
                        </button>
                        <button
                            class="account-tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                            data-type="lending">
                            Lending
                        </button>
                        <button
                            class="account-tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                            data-type="deposits">
                            Deposits
                        </button>
                        <button
                            class="account-tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                            data-type="pensions">
                            Pensions
                        </button>
                        <button
                            class="account-tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                            data-type="credit-cards">
                            Credit Cards
                        </button>
                    </nav>
                </div>

                <!-- Account Type Content -->
                <div id="monthDetailContent">
                    <!-- Current Accounts Section -->
                    <div class="account-tab-content" data-type="current">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Current Accounts Overview</h3>
                                <p class="text-sm text-gray-600">Day-to-day banking accounts for regular transactions
                                </p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.current %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %} account-row"
                                        data-id="{{ entry.id }}">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-900 bank-name">{{ entry.bank_name }}
                                                </h4>
                                                <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}
                                                </p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <div class="flex flex-col items-end">
                                                <span
                                                    class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                                    data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                    data-type="current" data-month="{{ month_name }}">
                                                    £{{ entry.amount }}
                                                </span>
                                                <div class="mt-2 flex space-x-2">
                                                    <button
                                                        class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline"
                                                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                        </svg>
                                                        Edit
                                                    </button>
                                                    <button
                                                        class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline"
                                                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                        </svg>
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No current accounts found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics remain unchanged -->
                                {% if month_data.current %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-blue-800">Total Balance</h4>
                                        <p class="text-2xl font-bold text-blue-600">£{{ month_data.current|sum_amounts
                                            }}</p>
                                    </div>
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-blue-800">Account Count</h4>
                                        <p class="text-2xl font-bold text-blue-600">{{ month_data.current|length }}</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Savings Accounts Section -->
                    <div class="account-tab-content hidden" data-type="savings">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Savings Accounts Overview</h3>
                                <p class="text-sm text-gray-600">Interest-earning accounts for long-term savings</p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.savings %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %}">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-900">{{ entry.bank_name }}</h4>
                                                <p class="text-sm text-gray-600">{{ entry.account_name }}</p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <span
                                                class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                                data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                data-type="savings" data-month="{{ month_name }}">
                                                £{{ entry.amount }}
                                            </span>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No savings accounts found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics -->
                                {% if month_data.savings %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-green-800">Total Savings</h4>
                                        <p class="text-2xl font-bold text-green-600">£{{ month_data.savings|sum_amounts
                                            }}</p>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-green-800">Account Count</h4>
                                        <p class="text-2xl font-bold text-green-600">{{ month_data.savings|length }}</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Lending Section -->
                    <div class="account-tab-content hidden" data-type="lending">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Lending Overview</h3>
                                <p class="text-sm text-gray-600">Loans and other lending accounts</p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.lending %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %}">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-900">{{ entry.bank_name }}</h4>
                                                <p class="text-sm text-gray-600">{{ entry.account_name }}</p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <span
                                                class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                                data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                data-type="lending" data-month="{{ month_name }}">
                                                £{{ entry.amount }}
                                            </span>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No lending accounts found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics -->
                                {% if month_data.lending %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-yellow-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-yellow-800">Total Lending</h4>
                                        <p class="text-2xl font-bold text-yellow-600">£{{ month_data.lending|sum_amounts
                                            }}</p>
                                    </div>
                                    <div class="bg-yellow-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-yellow-800">Account Count</h4>
                                        <p class="text-2xl font-bold text-yellow-600">{{ month_data.lending|length }}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Deposits Section -->
                    <div class="account-tab-content hidden" data-type="deposits">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Deposits Overview</h3>
                                <p class="text-sm text-gray-600">Fixed-term deposits and other deposit accounts</p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.deposits %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %}">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-900">{{ entry.bank_name }}</h4>
                                                <p class="text-sm text-gray-600">{{ entry.account_name }}</p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <span
                                                class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                                data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                data-type="deposits" data-month="{{ month_name }}">
                                                £{{ entry.amount }}
                                            </span>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No deposits found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics -->
                                {% if month_data.deposits %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-purple-800">Total Deposits</h4>
                                        <p class="text-2xl font-bold text-purple-600">£{{
                                            month_data.deposits|sum_amounts }}</p>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-purple-800">Account Count</h4>
                                        <p class="text-2xl font-bold text-purple-600">{{ month_data.deposits|length }}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Pensions Section -->
                    <div class="account-tab-content hidden" data-type="pensions">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Pensions Overview</h3>
                                <p class="text-sm text-gray-600">Retirement and pension accounts</p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.pensions %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %}">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h4 class="font-medium text-gray-900">{{ entry.bank_name }}</h4>
                                                <p class="text-sm text-gray-600">{{ entry.account_name }}</p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <span class="font-bold editable-amount text-green-600"
                                                data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                data-type="pensions" data-month="{{ month_name }}">
                                                £{{ entry.amount }}
                                            </span>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No pension accounts found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics -->
                                {% if month_data.pensions %}
                                <div class="bg-indigo-50 rounded-lg p-4">
                                    <h4 class="text-sm font-medium text-indigo-800">Total Pensions</h4>
                                    <p class="text-2xl font-bold text-indigo-600">£{{ month_data.pensions|sum_amounts }}
                                    </p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Credit Cards Section -->
                    <div class="account-tab-content hidden" data-type="credit-cards">
                        <div class="p-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Credit Cards Overview</h3>
                                <p class="text-sm text-gray-600">Credit card accounts and balances</p>
                            </div>

                            <div class="space-y-4">
                                <!-- Account List -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    {% for entry in month_data.credit_cards %}
                                    <div class="p-4 {% if not forloop.last %}border-b border-gray-200{% endif %}">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-900">{{ entry.bank_name }}</h4>
                                                <p class="text-sm text-gray-600">{{ entry.account_name }}</p>
                                                {% if entry.notes %}
                                                <p class="text-xs text-gray-500 mt-1">{{ entry.notes }}</p>
                                                {% endif %}
                                            </div>
                                            <span
                                                class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                                data-id="{{ entry.id }}" data-amount="{{ entry.amount }}"
                                                data-type="credit_cards" data-month="{{ month_name }}">
                                                £{{ entry.amount }}
                                            </span>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="p-4 text-center text-gray-500">
                                        <p>No credit card accounts found</p>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Statistics -->
                                {% if month_data.credit_cards %}
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-red-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-red-800">Total Credit Card Balance</h4>
                                        <p class="text-2xl font-bold text-red-600">£{{
                                            month_data.credit_cards|sum_amounts }}</p>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-red-800">Account Count</h4>
                                        <p class="text-2xl font-bold text-red-600">{{ month_data.credit_cards|length }}
                                        </p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- All Monthly Entries (Hidden by default) -->
            <div id="allMonthsContainer" class="hidden">
                {% for month_name, month_data in entries_by_month %}
                <div class="month-data-container" data-month="{{ month_name }}">
                    <!-- Current Accounts Tab Content -->
                    <div class="account-tab-content" data-type="current">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.current %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="current"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No current accounts</p>
                                {% endfor %}
            
                                {% if month_data.current %}
                                <div class="p-3 bg-blue-50 rounded mt-4 flex justify-between items-center">
                                    <p class="font-medium">Current Total</p>
                                    <span class="font-bold current-total" data-month="{{ month_name }}">
                                        £{{ month_data.current|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
            
                    <!-- Savings Tab Content -->
                    <div class="account-tab-content hidden" data-type="savings">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.savings %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="savings"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No savings accounts</p>
                                {% endfor %}
            
                                {% if month_data.savings %}
                                <div class="p-3 bg-green-50 rounded mt-2 flex justify-between items-center">
                                    <p class="font-medium">Savings Total</p>
                                    <span class="font-bold savings-total" data-month="{{ month_name }}">
                                        £{{ month_data.savings|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lending accounts -->
                    <div class="account-tab-content hidden" data-type="lending">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.lending %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="lending"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No lending accounts</p>
                                {% endfor %}
            
                                {% if month_data.lending %}
                                <div class="p-3 bg-yellow-50 rounded mt-2 flex justify-between items-center">
                                    <p class="font-medium">Lending Total</p>
                                    <span class="font-bold lending-total" data-month="{{ month_name }}">
                                        £{{ month_data.lending|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deposits accounts -->
                    <div class="account-tab-content hidden" data-type="deposits">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.deposits %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="deposits"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No deposits</p>
                                {% endfor %}
            
                                {% if month_data.deposits %}
                                <div class="p-3 bg-purple-50 rounded mt-2 flex justify-between items-center">
                                    <p class="font-medium">Deposits Total</p>
                                    <span class="font-bold deposits-total" data-month="{{ month_name }}">
                                        £{{ month_data.deposits|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pensions accounts -->
                    <div class="account-tab-content hidden" data-type="pensions">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.pensions %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="pensions"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No pensions</p>
                                {% endfor %}
            
                                {% if month_data.pensions %}
                                <div class="p-3 bg-indigo-50 rounded mt-2 flex justify-between items-center">
                                    <p class="font-medium">Pensions Total</p>
                                    <span class="font-bold pensions-total" data-month="{{ month_name }}">
                                        £{{ month_data.pensions|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Credit Cards accounts -->
                    <div class="account-tab-content hidden" data-type="credit-cards">
                        <div class="p-4">
                            <div class="space-y-2">
                                {% for entry in month_data.credit_cards %}
                                <div class="p-3 bg-gray-50 rounded flex justify-between items-center account-row" data-id="{{ entry.id }}">
                                    <div>
                                        <p class="font-medium bank-name">{{ entry.bank_name }}</p>
                                        <p class="text-sm text-gray-600 account-name">{{ entry.account_name }}</p>
                                        {% if entry.notes %}
                                        <p class="text-xs text-gray-500">{{ entry.notes }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="font-bold editable-amount {% if entry.amount < 0 %}text-red-600{% else %}text-green-600{% endif %}"
                                              data-id="{{ entry.id }}" data-amount="{{ entry.amount }}" data-type="credit_cards"
                                              data-month="{{ month_name }}">
                                            £{{ entry.amount }}
                                        </span>
                                        <div class="mt-2 flex space-x-2">
                                            <button class="edit-account-btn text-blue-600 hover:text-blue-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                </svg>
                                                Edit
                                            </button>
                                            <button class="delete-account-btn text-red-600 hover:text-red-800 text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-500 italic">No credit cards</p>
                                {% endfor %}

                                {% if month_data.credit_cards %}
                                <div class="p-3 bg-red-50 rounded mt-2 flex justify-between items-center">
                                    <p class="font-medium">Credit Cards Total</p>
                                    <span class="font-bold credit-cards-total" data-month="{{ month_name }}">
                                        £{{ month_data.credit_cards|sum_amounts }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Grand Total -->
                    <!-- Total Assets Section -->
                    <div class="p-4 bg-gray-100 border-t">
                        <div class="flex justify-between items-center font-semibold">
                            <p>Total Assets</p>
                            <span class="grand-total" data-month="{{ month_name }}">£{{
                                month_data|calculate_total_assets }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% include "tracker/account.html" %}

        <!-- Notification Toast -->
        <div id="notification"
            class="fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-md border-l-4 hidden transition-opacity duration-300 z-50">
            <p id="notificationMessage" class="text-sm font-medium"></p>
        </div>

        <!-- Include the account management script -->
        <script src="{% static 'js/account-management.js' %}"></script>
        <script src="{% static 'js/add-account.js' %}"></script>
        <script src="{% static 'js/site-style-config.js' %}"></script>
        <script src="{% static 'js/script.js' %}"></script>
        <script src="{% static 'js/chart.js' %}"></script>
        <script src="{% static 'js/background-animation.js' %}"></script>
        
</body>

</html>